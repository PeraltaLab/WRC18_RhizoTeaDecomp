panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = FALSE) +
scale_fill_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_shape_manual(labels = c("green_tea","rooibos_tea"),
values = c(21, 24)) +
theme(axis.title = element_text(size=14), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (22.2%)") + ylab("PCoA 2 (10.1%)") +
labs(fill = "treatment", shape = "source")
#Plot
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
plot1a + theme(panel.grid.major = element_blank(),
plot1a + theme(panel.grid.major = element_blank(),
plot1a + theme(panel.grid.major = element_blank(),
#Plot
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
#Plot
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE) +
scale_fill_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_shape_manual(labels = c("green_tea","rooibos_tea"),
values = c(21, 24)) +
theme(axis.title = element_text(size=14), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (22.2%)") + ylab("PCoA 2 (10.1%)") +
labs(fill = "treatment", shape = "source") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black")))
ggsave("../figures/Ordination_tea.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=9, height=7, dpi=300, limitsize=TRUE)
# Important Environmental data
design <- read.csv("../data/2018_WRC_SoilMicroDecomp_missing3t.csv", row.names=1)
# Import OTU data
# Import Raw Data
otu.in <- read.otu("../data/WRC18_opti_mcc.shared")
# Correct Sample IDs and Subset File
missing <- setdiff(rownames(otu.in), rownames(design))
otu <- otu.in[-(which(rownames(otu.in) %in% missing)), ]
dim(otu)
otu <- otu[match(rownames(design), rownames(otu)),]
all.equal(rownames(otu), rownames(design))
# OTU table - remove otus w/ < 2 occurrences across all sites
otu_removal <- otu[, which(colSums(otu) >= 2)]
dim(otu_removal)
aa <- (rowSums(otu_removal))
aa # WRC18_10_Tea-155 reads WRC18_13_Tea-29 reads - removed
# OTU table - removed low abundance samples
otu_low_remov <- otu_removal[which(rowSums(otu_removal) >= 1000), ]
dim(otu_low_remov)
# OTU table - odd sites in bacterial composition data and remove in design file
odd.sites <- c("WRC18_10_Tea","WRC18_13_Tea")
otu_final <- otu_low_remov[setdiff(rownames(otu_low_remov), odd.sites), ]
design_final <- design[setdiff(rownames(design), odd.sites), ]
all.equal(rownames(design_final), rownames(otu_final))
otus <- otu_final
# Make Presence Absence Matrix
dataPA <- (otus > 0) * 1
# Make Relative Abundance Matrices
dataREL <- otus
for(i in 1:dim(otus)[1]){
dataREL[i,] <- otus[i,]/sum(otus[i,])
}
# Rarefy Abundances (min abundance is 29485. We are sampling to 29000)
min(rowSums(otus))
#PERMANOVA
new.data <-cbind(design_final,dataREL)
adonis = adonis(new.data[,-c(1:16)]~source*treatment*ditch, method = "bray", data = new.data, perm=1000)
adonis
# Principal Coordinates Analysis
dataREL.dist <- vegdist(dataREL, method="bray")
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #43.3
explainvar2b #10.6
# Principal Coordinates Analysis
# Principal Coordinates Analysis - teas only #NEED to incorporate ditch
pcoa.groups <- paste(new.data$treatment, new.data$source, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # treatment
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # source
#Plot
df2a <- as.data.frame(pcoa.cent.dataframe)
plot2a <- ggplot(df2a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot2a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE) +
scale_fill_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_shape_manual(labels = c("bulk_soil","green_tea","rooibos_tea"),
values = c(21, 24, 25)) +
theme(axis.title = element_text(size=14), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (43.3%)") + ylab("PCoA 2 (10.6%)") +
labs(fill = "treatment", shape = "source") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black")))
plot2a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE) +
scale_fill_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_shape_manual(labels = c("bulk_soil","green_tea","rooibos_tea"),
values = c(21, 24, 25)) +
theme(axis.title = element_text(size=14), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm"))
plot2a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE) +
scale_fill_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_shape_manual(labels = c("bulk_soil","green_tea","rooibos_tea"),
values = c(21, 24, 25))
df2a <- as.data.frame(pcoa.cent.dataframe)
plot2a <- ggplot(df2a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot2a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE) +
scale_fill_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen"))
df2a <- as.data.frame(pcoa.cent.dataframe)
plot2a <- ggplot(df2a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot2a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE)
# Principal Coordinates Analysis
# Principal Coordinates Analysis - teas only #NEED to incorporate ditch
pcoa.groups <- paste(new.data$source, new.data$treatment, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # treatment
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # source
#Plot
df2a <- as.data.frame(pcoa.cent.dataframe)
plot2a <- ggplot(df2a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot2a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE) +
scale_fill_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_shape_manual(labels = c("bulk_soil","green_tea","rooibos_tea"),
values = c(21, 24, 25)) +
theme(axis.title = element_text(size=14), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (43.3%)") + ylab("PCoA 2 (10.6%)") +
labs(fill = "treatment", shape = "source") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black")))
rm(list=ls())
setwd("~/GitHub/WRC18_RhizoTeaDecomp/analyses")
se <- function(x, ...){sd(x, na.rm = TRUE)/sqrt(length(na.omit(x)))}
ci <- function(x, ...){1.96 * sd(x,na.rm = TRUE)}
# Code Dependencies
source("../bin/DiversityFunctions.R")
source("../bin/MothurTools.R")
require("vegan")
require("nlme")
require("reshape")
require("ggplot2")
require("ade4")
require("png")
require ("agricolae")
require("tidyr")
require("dplyr")
require("reshape2")
require("picante")
# Import Environmental Data
design <- read.csv("../data/2018_WRC_SoilMicroDecomp_missing3t.csv", row.names=1)
# Import OTU data
# Import Raw Data
otu.in <- read.otu("../data/WRC18_opti_mcc.shared")
# Correct Sample IDs and Subset File
missing <- setdiff(rownames(otu.in), rownames(design))
otu <- otu.in[-(which(rownames(otu.in) %in% missing)), ]
dim(otu)
otu <- otu[match(rownames(design), rownames(otu)),]
all.equal(rownames(otu), rownames(design))
# OTU table - remove otus w/ < 2 occurrences across all sites
otu_removal <- otu[, which(colSums(otu) >= 2)]
dim(otu_removal)
aa <- (rowSums(otu_removal))
aa # WRC18_10_Tea-155 reads WRC18_13_Tea-29 reads - removed
# OTU table - removed low abundance samples
otu_low_remov <- otu_removal[which(rowSums(otu_removal) >= 1000), ]
dim(otu_low_remov)
# OTU table - odd sites in bacterial composition data and remove in design file
odd.sites <- c("WRC18_10_Tea","WRC18_13_Tea")
otu_final <- otu_low_remov[setdiff(rownames(otu_low_remov), odd.sites), ]
design_final <- design[setdiff(rownames(design), odd.sites), ]
all.equal(rownames(design_final), rownames(otu_final))
otus <- otu_final
###subset tea only
otus.design <- cbind(design_final,otus)
otus.design.teas <- subset(otus.design, source == "green_tea" | source == "rooibos_tea")
dim(otus.design.teas)
design.t <- otus.design.teas[,c(1:16)]
otus.t <- otus.design.teas[,-c(1:16)]
#full df - otus.design.teas
# Make Relative Abundance Matrices
dataREL.t <- otus.t
for(i in 1:dim(otus.t)[1]){
dataREL.t[i,] <- otus.t[i,]/sum(otus.t[i,])
}
# Principal Coordinates Analysis
dataREL.dist <- vegdist(dataREL.t, method="bray")
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #22.2
explainvar2b #10.1
# Principal Coordinates Analysis - teas only #NEED to incorporate ditch
#new.data.t <-cbind(design.t,dataREL.t)
droplevels(new.data.t$source)
#PERMANOVA
new.data.t <-cbind(design.t,dataREL.t)
adonis = adonis(new.data.t[,-c(1:16)]~source*treatment*ditch, method = "bray", data = new.data.t, perm=1000)
adonis
# Principal Coordinates Analysis
dataREL.dist <- vegdist(dataREL.t, method="bray")
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #22.2
explainvar2b #10.1
# Principal Coordinates Analysis - teas only #NEED to incorporate ditch
#new.data.t <-cbind(design.t,dataREL.t)
droplevels(new.data.t$source)
pcoa.groups <- paste(new.data.t$treatment, new.data.t$source, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # treatment
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # source
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black")
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE)
pcoa.groups <- paste(new.data.t$source, new.data.t$treatment, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # treatment
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # source
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE)
# Principal Coordinates Analysis - teas only #NEED to incorporate ditch
new.data.t <-cbind(design.t,dataREL.t)
droplevels(new.data.t$source)
pcoa.groups <- paste(new.data.t$source, new.data.t$treatment, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # treatment
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # source
#Plot
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE) +
scale_fill_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_shape_manual(labels = c("green_tea","rooibos_tea"),
values = c(21, 24)) +
theme(axis.title = element_text(size=14), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (22.2%)") + ylab("PCoA 2 (10.1%)") +
labs(fill = "treatment", shape = "source") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black")))
pcoa.groups <- paste(new.data.t$treatment, new.data.t$source, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # treatment
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # source
#Plot
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE) +
scale_fill_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_shape_manual(labels = c("green_tea","rooibos_tea"),
values = c(21, 24)) +
theme(axis.title = element_text(size=14), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (22.2%)") + ylab("PCoA 2 (10.1%)") +
labs(fill = "treatment", shape = "source") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black")))
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE)
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black"))
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE)
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape)))
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a
#Plot
df1a <- as.data.frame(pcoa.cent.dataframe)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE) +
scale_colour_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_shape_manual(labels = c("green_tea","rooibos_tea"),
values = c(21, 24)) +
theme(axis.title = element_text(size=14), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (22.2%)") + ylab("PCoA 2 (10.1%)") +
labs(fill = "treatment", shape = "source") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black")))
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=5, stroke = 0.75, show.legend = TRUE) +
scale_colour_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_fill_manual(labels = c("mowed","mowed/fertilized"),
values = c("gray", "darkgreen")) +
scale_shape_manual(labels = c("green_tea","rooibos_tea"),
values = c(21, 24)) +
theme(axis.title = element_text(size=14), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (22.2%)") + ylab("PCoA 2 (10.1%)") +
labs(fill = "treatment", shape = "source") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black")))
ggsave("../figures/Ordination_tea.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=9, height=7, dpi=300, limitsize=TRUE)
