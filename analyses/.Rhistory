p <- ggplot(meta, aes(x=treatment, y=fun.shannon, color=as.factor(treatment)))+ geom_boxplot() +
geom_point(aes(color=factor(treatment)), size=2, position = position_jitterdodge()) + scale_color_manual(name="Treatment", values=c("gray70", "darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized"))
p1=p+geom_smooth(method="lm")
f_shannon<-p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line
=element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=14,face="bold"),
axis.text=element_text(size=14), axis.text.x = element_text(vjust=0.65, hjust=0.5,
size=14), panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) + labs(x = "Treatment", y = "Shannon Diversity Index (H')") +
theme(strip.text.x = element_text(size=14, face="bold"), strip.text.y =
element_text(size=14, face="bold"), strip.background = element_rect(colour="black",
fill="white", size=1)) +
scale_x_discrete(breaks=c("M", "MF"), labels=c("unfertilized", "fertilized"))
# + ggtitle("Fungal Diversity (2018)")
f_shannon
ggsave("../figures/2018.fungal.shannon.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
#Plot
p <- ggplot(meta, aes(x=treatment, y=fun.shannon, color=as.factor(treatment)))+ geom_boxplot() +
geom_point(aes(color=factor(treatment)), size=2, position = position_jitterdodge()) + scale_color_manual(name="Treatment", values=c("gray70", "darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized"))
p1=p+geom_smooth(method="lm")
f_shannon<-p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line
=element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=14,face="bold"),
axis.text=element_text(size=14), axis.text.x = element_text(vjust=0.65, hjust=0.5,
size=14), panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) + labs(x = "Treatment", y = "Shannon Diversity Index (H')") +
theme(strip.text.x = element_text(size=14, face="bold"), strip.text.y =
element_text(size=14, face="bold"), strip.background = element_rect(colour="black",
fill="white", size=1)) +
scale_x_discrete(breaks=c("M", "MF"), labels=c("unfertilized", "fertilized"))
=element_line(colour = "black")) +
f_shannon<-p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line
=element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=14,face="bold"),
axis.text=element_text(size=14), axis.text.x = element_text(vjust=0.65, hjust=0.5,
size=14), panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) + labs(x = "Treatment", y = "Shannon Diversity Index (H')") +
theme(strip.text.x = element_text(size=14, face="bold"), strip.text.y =
element_text(size=14, face="bold"), strip.background = element_rect(colour="black",
fill="white", size=1)) +
scale_x_discrete(breaks=c("M", "MF"), labels=c("unfertilized", "fertilized")) + ggtitle("Fungal Diversity (2018)")
f_shannon
ggsave("../figures/2018.fungal.shannon.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
PCC <- read.csv("../data/WRC18_plant_RA.csv", header=TRUE)
design <- read.csv("../data/2018.diversity.plant.csv", header=TRUE)
PCC.2018 <- subset(PCC, treatment == "M" | treatment == "MF")
PCC.2018 <- cbind(design$block,PCC.2018)
PCC.2018 <- PCC.2018 %>% filter(design$block=='2'|design$block=='4'|design$block=='6'|design$block=='8')
PCC.2018b <- PCC.2018[,-c(1:3)]
labels(PCC.2018b)
PCC.2018a <- PCC.2018b[, which(colSums(PCC.2018b) > 0)]
design.even <- PCC.2018[,c(1:3)]
PCC.2018.even <- cbind(design.even,PCC.2018a)
# Fisher's Alpha
PCC.2018.PA <- decostand(PCC.2018a, method="pa", na.rm=TRUE)
# Species Richness
richness <- rowSums((PCC.2018.PA >= 1))
# Shannon Diversity
shannon <- diversity(PCC.2018a, "shannon")
# Simpson's Evenness
simp.even <- apply(PCC.2018a, 1, simp_even)
#Pielouâ€™s evenness
J <- shannon/log(specnumber(PCC.2018a[,-c(1:1)]))
#combined richness, diversity, evenness
diversity.plant.even <- cbind(meta,richness,shannon,simp.even,J)
#Adding diversity fields to dataset
meta$plant.shannon <- diversity.plant.even$shannon
meta$plant.J <- diversity.plant.even$J
meta$plant.simp <- diversity.plant.even$simp.even
meta$plant.rich <- diversity.plant.even$richness
colnames(meta) #total columns is 36
library(lmerTest)
plant.rich.lm <- aov(plant.rich ~ treatment, data = meta)
plot(plant.rich.lm)
anova(plant.rich.lm)
plant.shannon.lm <- aov(plant.shannon ~ treatment, data = meta)
plot(plant.shannon.lm)
anova(plant.shannon.lm)
# Graphing Richness
p <- ggplot(meta, aes(x=treatment, y=plant.rich, color=as.factor(treatment)))+ geom_boxplot() +
geom_point(aes(color=factor(treatment)), size=2, position = position_jitterdodge()) + scale_color_manual(name="Treatment", values=c("gray70", "darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized"))
p1=p+geom_smooth(method="lm")
shannon.plant <-p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line
=element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=14,face="bold"),
axis.text=element_text(size=14), axis.text.x = element_text(vjust=0.65, hjust=0.5,
size=14), panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) + labs(x = "Treatment", y = "Plant Species Richness") +
theme(strip.text.x = element_text(size=14, face="bold"), strip.text.y =
element_text(size=14, face="bold"), strip.background = element_rect(colour="black",
fill="white", size=1)) +
scale_x_discrete(breaks=c("M", "MF"), labels=c("unfertilized", "fertilized"))
#+ ggtitle("Plant Diversity (2018 - wet)")
shannon.plant
ggsave("../figures/2018.plant.richness.even.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
# Graphing Shannon Diversity
p <- ggplot(meta, aes(x=treatment, y=plant.shannon, color=as.factor(treatment)))+ geom_boxplot() +
geom_point(aes(color=factor(treatment)), size=2, position = position_jitterdodge()) + scale_color_manual(name="Treatment", values=c("gray70", "darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized"))
p1=p+geom_smooth(method="lm")
shannon.plant <-p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line
=element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=14,face="bold"),
axis.text=element_text(size=14), axis.text.x = element_text(vjust=0.65, hjust=0.5,
size=14), panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) + labs(x = "Treatment", y = "Shannon Diversity Index (H')") +
theme(strip.text.x = element_text(size=14, face="bold"), strip.text.y =
element_text(size=14, face="bold"), strip.background = element_rect(colour="black",
fill="white", size=1)) +
scale_x_discrete(breaks=c("M", "MF"), labels=c("unfertilized", "fertilized"))+ ggtitle("Plant Diversity (2018 - wet)")
shannon.plant
ggsave("../figures/2018.plant.shannon.even.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
#PERMANOVA
adonis = adonis(PCC.2018.even[,-c(1:3)]~treatment, method = "bray", data = PCC.2018.even, perm=1000)
adonis
# Principal Coordinates Analysis
dataREL.dist <- vegdist(PCC.2018.even[,-c(1:3)], method="bray")
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #54.3
explainvar2b #23.2
# Principal Coordinates Analysis - plants
pcoa.groups <- paste(PCC.2018.even$treatment)
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
trt <- c("M","MF")
pcoa.cent.dataframe.trts <- as.data.frame(pcoa.cent.dataframe)
pcoa.cent.dataframe.trts$trt <- as.factor(trt)
#Plot
df2a <- as.data.frame(pcoa.cent.dataframe.trts)
plot2a <- ggplot(df2a, aes(x=V1, y=V2, colour=trt)) + theme_bw()
plot2a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(colour=trt), size=5, stroke = 1.25, show.legend = TRUE) +
scale_colour_manual(labels = c("mowed/unfertilized","mowed/fertilized"),
values = c("gray70", "darkgreen")) +
theme(axis.title = element_text(size=14),
axis.text = element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size = 1.25)) +
theme(axis.ticks.length = unit(0.3, "cm")) +
xlab("PCoA 1 (54.3%)") + ylab("PCoA 2 (23.2%)") +
labs(colour = "Treatment") +
guides(colour = guide_legend(override.aes = list(pch=16, size = 4)))
#+ ggtitle("Plant Community Composition (2018 - wet)")
ggsave("../figures/2018.plant.even.ordination.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
#Read in OTU file
otu <- read.otu(sharedfile)
#Remove OTUs with less than 2 occurences across all sites
b <- ncol(otu)
reads <- sum(colSums(otu))
#reads before filtering
otu.2 <- otu[, which(colSums(otu) > 10)]
#Remove all RP samples
#In the original WRC2015 sampling I collected bulk soils, and rhizospehre soils. Soil loosley adhering to roots was shaken into a bag (RP) for DNA and soil NH4/NO3 extraction. Roots and adhering soils collected for DNA processing (RS). Removed RP from DNA analysis.
#WRC15_65-WRC15_80
rownames(otu.2)
otu.2 <-otu.2[-c(33:48),]
rownames(otu.2)
#FROM OTU - remove blocks 1, 3, 5, 7 and treatments C & F
#First join meta and otu. Filter and then remove extra columns
meta_all <- read.csv(metafile)
otu.2.filter <- cbind(meta_all, otu.2)
otu.2.filter <- otu.2.filter %>%
filter(year==2018) %>%
filter(source=="bulk") %>%
filter(treatment=="M" | treatment =="MF") %>%
filter(block==2 | block==4 | block==6 | block==8)
rownames(otu.2.filter)<- otu.2.filter$sample
otu.2 <- otu.2.filter[,-c(1:26)]
rownames(otu.2.filter)
colnames(otu.2.filter)
#What sample has lowest read count? WRC18_201 16668, next lowest is WRC18_200 43192 highest WRC15_167 68819
otu2<- colSums(t(otu.2))
otu2
otu2[which.min(colSums(t(otu.2)))]
otu2[which.max(colSums(t(otu.2)))]
# Import Taxonomy File
otu.tax <- read.tax(taxonomy = "../data/WRC18_opti_mcc.0.03.cons.taxonomy",
format = "rdp", tax.levels = 6, col.tax = 3)
#graph of read counts, need to work on y axis
c<-as.data.frame(otu.2)
c$colsum <- colSums(t(c))
c$group <- rownames(c)
p<-ggplot(c, aes(x=group,y=colsum))+geom_bar(stat="identity")+coord_flip()
p
#Rarefy
#Set min sample number
min.N <- min(rowSums(otu.2))
#rrarefy returns a randomly rarefied community data frame or vector of selected size
#This is the otu set that should be used for beta diversity metrics
otu.rare <- rrarefy(otu.2, min.N)
#rarefy returns a species richness estimate in a random subsample of selected size
otu.rare.rich <- rarefy(x = otu.2, sample=min.N, se=T)
#Plot rarefaction curve
###suggests that we did not capture all of the diversity b/c the accumulation curve does not level off or flatten - rather, it continues to increase
rarecurve(x = otu.2, step = 20, col="blue", cex=0.6, las=1)
abline(0,1,col='red')
text(1000,1000,"1:1",pos=2, col='red')
#transforms read counts to relative abundance
#Using rarefied OTU dataset
otu.2.rel <- otu.rare
for(i in 1:dim(otu.rare)[1]){
otu.2.rel[i,] <- otu.rare[i,]/sum(otu.rare[i,])
}
#Combine experimental deisng meta data with OTU relative abundance data
metaotu <- cbind(meta, otu.2.rel)
#Transform data to reflect only presence or absence ie 0 or 1
otu.2.PA<-(otu.rare>0*1)
#sanity check
#otu.2.PA[,1:5]
#Add meta data
metaotu.2 <- cbind(meta, otu.2.PA)
#metaotu.2[1:15]
#Transform True/False to 0/1
cols <- sapply(metaotu.2, is.logical)
metaotu.2[,cols]<-lapply(metaotu.2[,cols],as.numeric)
#head(metaotu.2)
# Calculate diversity metrics
bac.shannon <- vegan::diversity(otu.rare, "shannon")
bac.simp <- vegan::diversity(otu.rare, "simpson")
bac.invsimp <-vegan::diversity(otu.rare, "invsimpson")
# Pielous evenness (uses presence/absence data)
bac.J <- bac.shannon/log(specnumber(otu.2.PA[,-c(1:1)]))
#OTU richness
bac.richness <- rowSums((otu.2.PA >= 1))
#Adding diversity fields to dataset
meta$bac.shannon <- bac.shannon
meta$bac.J <- bac.J
meta$bac.simp <- bac.simp
meta$bac.invsimp <- bac.invsimp
meta$bac.richness <- bac.richness
colnames(meta) #total non-OTU columns is 42
bac.shannon.lm <- aov(bac.shannon ~ treatment, data = meta)
plot(bac.shannon.lm)
anova(bac.shannon.lm)
# Graphing Shannon Diversity
p <- ggplot(meta, aes(x=treatment, y=bac.shannon, color=as.factor(treatment)))+ geom_boxplot() +
geom_point(aes(color=factor(treatment)), size=2, position = position_jitterdodge()) + scale_color_manual(name="Treatment", values=c("gray70", "darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized"))
p1=p+geom_smooth(method="lm")
bac.shannon<-p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line
=element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=14,face="bold"),
axis.text=element_text(size=14), axis.text.x = element_text(vjust=0.65, hjust=0.5,
size=14), panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) + labs(x = "Treatment", y = "Shannon Diversity Index (H')") +
theme(strip.text.x = element_text(size=14, face="bold"), strip.text.y =
element_text(size=14, face="bold"), strip.background = element_rect(colour="black",
fill="white", size=1)) +
scale_x_discrete(breaks=c("M", "MF"), labels=c("unfertilized", "fertilized")) + ggtitle("Bacterial Diversity (2018 - wet)")
bac.shannon
ggsave("../figures/2018.bacteria.even.shannon.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
bac.richness.lm <- aov(bac.richness ~ treatment, data = meta)
plot(bac.richness.lm)
anova(bac.richness.lm)
# Graphing Richness Diversity
p <- ggplot(meta, aes(x=treatment, y=bac.richness, color=as.factor(treatment)))+ geom_boxplot() +
geom_point(aes(color=factor(treatment)), size=2, position = position_jitterdodge()) + scale_color_manual(name="Treatment", values=c("gray70", "darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized"))
p1=p+geom_smooth(method="lm")
bac.shannon<-p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line
=element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=14,face="bold"),
axis.text=element_text(size=14), axis.text.x = element_text(vjust=0.65, hjust=0.5,
size=14), panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) + labs(x = "Treatment", y = "Bacterial OTU Richness") +
theme(strip.text.x = element_text(size=14, face="bold"), strip.text.y =
element_text(size=14, face="bold"), strip.background = element_rect(colour="black",
fill="white", size=1)) +
scale_x_discrete(breaks=c("M", "MF"), labels=c("unfertilized", "fertilized"))
#+ ggtitle("Bacterial OTU Richness (2018 - wet)")
bac.shannon
ggsave("../figures/2018.bacteria.even.richness.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
#PERMANOVA
metaotu.ad <- adonis(metaotu[,-c(1:42)] ~ treatment, method = "bray", data = metaotu, perm=1000, set.seed=42)
metaotu.ad
# Principal Coordinates Analysis
dataREL.dist <- vegdist(metaotu[,-c(1:42)], method="bray")
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #37.9
explainvar2b #23.2
# Principal Coordinates Analysis
pcoa.groups <- paste(metaotu$treatment)
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
trt <- c("M","MF")
pcoa.cent.dataframe.trts <- as.data.frame(pcoa.cent.dataframe)
pcoa.cent.dataframe.trts$trt <- as.factor(trt)
#Plot
df1a <- as.data.frame(pcoa.cent.dataframe.trts)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=trt)) + theme_bw()
bact.ord <-plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(colour=trt), size=5, stroke = 1.25, show.legend = TRUE) +
scale_colour_manual(labels = c("mowed/unfertilized","mowed/fertilized"),
values = c("gray70", "darkgreen")) +
theme(axis.title = element_text(size=14),
axis.text = element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size = 1.25)) +
theme(axis.ticks.length = unit(0.3, "cm")) +
xlab("PCoA 1 (37.4%)") + ylab("PCoA 2 (23.2%)") +
labs(colour = "Treatment") +
guides(colour = guide_legend(override.aes = list(pch=16, size = 4)),
shape = guide_legend(override.aes = list(size = 4))) +
scale_x_discrete(breaks=c("M", "MF"), labels=c("unfertilized", "fertilized"))
#+ ggtitle("Bacterial Community Composition (2018 - wet)")
bact.ord
ggsave("../figures/2018.bact.ordination.bulk.even.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
colnames(metaotu)  #total non-OTU columns is 42
dist.plant <- vegdist(PCC.2018.even[,-c(1:3)], method="bray")
dist.bac <- vegdist(metaotu[,-c(1:42)], method="bray")
#MANTEL - all even blocks
mantel.rtest(dist.plant, dist.bac, nrepet = 999) #all treatments and ditch included - Mantel r = 0.631, p = 0.006
#separate by treatment
##PLANT
PCC.2018.M <- subset(PCC.2018.even, treatment == "M")
PCC.2018.MF <- subset(PCC.2018.even, treatment == "MF")
dist.plant.M <- vegdist(PCC.2018.M[,-c(1:3)], method="bray")
dist.plant.MF <- vegdist(PCC.2018.MF[,-c(1:3)], method="bray")
##BACTERIA
bac.2018.M <- subset(metaotu, treatment == "M")
bac.2018.MF <- subset(metaotu, treatment == "MF")
dist.bac.M <- vegdist(bac.2018.M[,-c(1:42)], method="bray")
dist.bac.MF <- vegdist(bac.2018.MF[,-c(1:42)], method="bray")
# MANTEL TESTS - even blocks only
mantel.rtest(dist.plant, dist.bac, nrepet = 999) # mowed only: Mantel r = 0.631, p = 0.004
mantel.rtest(dist.plant.M, dist.bac.M, nrepet = 999) # mowed only: Mantel r = 0.564, p = 0.159
mantel.rtest(dist.plant.MF, dist.bac.MF, nrepet = 999) # mowed/fert: Mantel r = 0.369, p = 0.287
# correlation alpha diversity
colnames(meta)
meta.M <- subset(meta, treatment == "M")
meta.MF <- subset(meta, treatment == "MF")
cor.test(meta$plant.shannon, meta$bac.shannon) # ALL: Pearsonn rho = -0.940, p = 0.0008
cor.test(meta.M$plant.shannon, meta.M$bac.shannon) # ALL: Pearsonn rho = -0.503, p = 0.497
cor.test(meta.MF$plant.shannon, meta.MF$bac.shannon) # ALL: Pearsonn rho = -0.940, p = 0.060
p <- ggplot(meta, aes(x=plant.shannon, y=bac.shannon, color=treatment)) +
scale_color_manual(name="Treatment", values=c("gray70","darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized")) +
geom_point(size=4)
p1=p+geom_smooth(method="lm")
shannon.cor <- p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=16),
axis.text=element_text(size=16),
axis.text.x = element_text(vjust=0.65, hjust=0.5, size=16),
panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
labs(x = "Plant Shannon Diversity Index (H')", y = "Bacterial Shannon Diversity Index (H')") +
theme(strip.text.x = element_text(size=16, face="bold"), strip.text.y = element_text(size=16, face="bold"), strip.background = element_rect(colour="black", fill="white", size=1)) #+ ggtitle("Bacterial-Plant Relationship (2018 - wet)")
shannon.cor
ggsave("../figures/2018.plant.bact.shannon.even.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
##FUNGAL
#fun_metaotu <- cbind(meta, fungal_otu.rel)
#fun.2018.otu <- subset(fun_metaotu[,-c(1:26)])
##separate M vs MF for Mantel tests later
#fun.2018.metaotu.M <- subset(fun_metaotu, treatment == "M")
#fun.2018.metaotu.MF <- subset(fun_metaotu, treatment == "MF")
#fun.2018.otu.M <- subset(fun.2018.metaotu.M[,-c(1:26)])
#fun.2018.otu.MF <- subset(fun.2018.metaotu.MF[,-c(1:26)])
dist.fungal <- vegdist(fun.2018.otu, method="bray")
dist.fungal.M <- vegdist(fun.2018.otu.M, method="bray")
dist.fungal.MF <- vegdist(fun.2018.otu.MF, method="bray")
##PLANT - completed in previous chunk
#dist.plant <- vegdist(PCC.2018[,-c(1:3)], method="bray")
#dist.plant.M <- vegdist(PCC.2018.M[,-c(1:3)], method="bray")
#dist.plant.MF <- vegdist(PCC.2018.MF[,-c(1:3)], method="bray")
# MANTEL TESTS
mantel.rtest(dist.plant, dist.fungal, nrepet = 999) #ALL - Mantel r = 0.664, p = 0.002
mantel.rtest(dist.plant.M, dist.fungal.M, nrepet = 999) #mowed only: Mantel r = 0.405, p = 0.242
mantel.rtest(dist.plant.MF, dist.fungal.MF, nrepet = 999) #mowed/fert: Mantel r = 0.569, p = 0.071
# correlation shannon diversity
cor.test(meta$fun.shannon, meta$plant.shannon) # ALL: Pearson rho = 0.185, p = 0.661
cor.test(meta.M$fun.shannon, meta.M$plant.shannon) # mowed only: Pearson rho = -0.069, p = 0.932
cor.test(meta.MF$fun.shannon, meta.MF$plant.shannon) # mowed/fert: Pearson rho = -0.268, p = 0.732
# change the x and y to reflect plant and fungi
p <- ggplot(meta, aes(x=plant.shannon, y=fun.shannon, color=treatment)) +
scale_color_manual(name="Treatment", values=c("gray70","darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized")) +
geom_point(size=4)
p1=p+geom_smooth(method="lm")
shannon.cor <- p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=16),
axis.text=element_text(size=16),
axis.text.x = element_text(vjust=0.65, hjust=0.5, size=16),
panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
labs(x = "Plant Shannon Diversity Index (H')", y = "Fungal Shannon Diversity Index (H')") +
theme(strip.text.x = element_text(size=16, face="bold"), strip.text.y = element_text(size=16, face="bold"), strip.background = element_rect(colour="black", fill="white", size=1)) #+ ggtitle("Plant-Fungal Relationship (2018 - wet)")
shannon.cor
ggsave("../figures/2018.plant.fun.shannon.even.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
# change the x and y to reflect plant and fungi
p <- ggplot(meta, aes(x=fun.shannon, y=bac.shannon, color=treatment)) +
scale_color_manual(name="Treatment", values=c("gray70","darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized")) +
geom_point(size=4)
p1=p+geom_smooth(method="lm")
shannon.cor <- p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=16),
axis.text=element_text(size=16),
axis.text.x = element_text(vjust=0.65, hjust=0.5, size=16),
panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
labs(x = "Fungal Shannon Diversity Index (H')", y = "Bacterial Shannon Diversity Index (H')") +
theme(strip.text.x = element_text(size=16, face="bold"), strip.text.y = element_text(size=16, face="bold"), strip.background = element_rect(colour="black", fill="white", size=1)) #+ ggtitle("Bacterial-Fungal Relationship (2018 - wet)")
shannon.cor
ggsave("../figures/2018.bact.fun.shannon.even.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
file_path <- ("../data/2018WRC_CNPS_shannon.csv")
CNPS_shannon <- read.csv(file_path)
CNPS_shannon_bulk <- subset(CNPS_shannon, source=='bulk')
meta$eco_shannon <- CNPS_shannon_bulk$eco_shannon
meta.M <- subset(meta, treatment == "M")
meta.MF <- subset(meta, treatment == "MF")
cor.test(meta$fun.shannon, meta$eco_shannon) # ALL: Pearson rho = 0.075, p = 0.860
cor.test(meta$plant.shannon, meta$eco_shannon) # ALL: Pearson rho = -0.023, p = 0.957
cor.test(meta$bac.shannon, meta$eco_shannon) # ALL: Pearson rho = -0.015, p = 0.972
p <- ggplot(meta, aes(x=eco_shannon, y=bac.shannon, color=treatment)) +
scale_color_manual(name="Treatment", values=c("gray70","darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized")) +
geom_point(size=4)
p1=p+geom_smooth(method="lm")
shannon.cor <- p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=16),
axis.text=element_text(size=16),
axis.text.x = element_text(vjust=0.65, hjust=0.5, size=16),
panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
labs(x = "Carbon Metabolic Diversity Index (H')", y = "Bacterial Shannon Diversity Index (H')") +
theme(strip.text.x = element_text(size=16, face="bold"), strip.text.y = element_text(size=16, face="bold"), strip.background = element_rect(colour="black", fill="white", size=1)) #+ ggtitle("Bacterial-Carbon Process Relationship (2018 - wet)")
shannon.cor
ggsave("../figures/2018.bact.carbon.shannon.even.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
# Graphing carbon metabolic Shannon Diversity
carbon.diversity.lm <- aov(eco_shannon ~ treatment, data = meta)
plot(carbon.diversity.lm)
anova(carbon.diversity.lm) #NS
p <- ggplot(meta, aes(x=treatment, y=eco_shannon, color=as.factor(treatment)))+ geom_boxplot() +
geom_point(aes(color=factor(treatment)), size=2, position = position_jitterdodge()) + scale_color_manual(name="Treatment", values=c("gray70", "darkgreen"), labels = c("mowed/unfertilized", "mowed/fertilized"))
p1=p+geom_smooth(method="lm")
carbon.shannon<-p1 + theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line
=element_line(colour = "black")) +
theme(axis.title=element_text(vjust=1,size=14,face="bold"),
axis.text=element_text(size=14), axis.text.x = element_text(vjust=0.65, hjust=0.5,
size=14), panel.border = element_rect(colour = "black",size=1)) +
theme(axis.ticks.length=unit(0.3,"cm")) + labs(x = "Treatment", y = "Carbon Metabolic Diversity Index (H')") +
theme(strip.text.x = element_text(size=14, face="bold"), strip.text.y =
element_text(size=14, face="bold"), strip.background = element_rect(colour="black",
fill="white", size=1)) +
scale_x_discrete(breaks=c("M", "MF"), labels=c("unfertilized", "fertilized")) + ggtitle("Carbon Metabolic Diversity (2018 - wet)")
carbon.shannon
ggsave("../figures/2018.carbon.metabolic.shannon.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=7, height=5, dpi=300, limitsize=TRUE)
cor.test(meta.M$bac.shannon, meta.M$eco_shannon) # mowed only: Pearson rho = -0.069, p = 0.932
cor.test(meta.M$bac.shannon, meta.M$eco_shannon) # mowed only: Pearson rho = 0.400, p = 0.600
cor.test(meta.MF$bac.shannon, meta.MF$eco_shannon) # mowed/fert: Pearson rho = -0.268, p = 0.732
# correlation shannon diversity
cor.test(meta.M$fun.shannon, meta.M$bac.shannon) # mowed only: Pearson rho = -0.069, p = 0.932
# correlation shannon diversity
cor.test(meta.M$fun.shannon, meta.M$bac.shannon) # mowed only: Pearson rho = 0.921, p = 0.079
cor.test(meta.MF$fun.shannon, meta.MF$bac.shannon) # mowed/fert: Pearson rho = -0.268, p = 0.732
plant.shannon.lm <- aov(plant.shannon ~ treatment, data = meta)
plot(plant.shannon.lm)
anova(plant.shannon.lm)
fun.shannon.lm <- aov(fun.shannon ~ treatment, data = meta)
plot(fun.shannon.lm)
anova(fun.shannon.lm)
#Run richness first. interaction, levels, and treatments for plotting set there
fun.rich.lm <- aov(fun.s.obs ~ treatment, data = meta)
plot(fun.rich.lm)
anova(fun.rich.lm)
plant.rich.lm <- aov(plant.rich ~ treatment, data = meta)
plot(plant.rich.lm)
anova(plant.rich.lm)
bac.richness.lm <- aov(bac.richness ~ treatment, data = meta)
plot(bac.richness.lm)
anova(bac.richness.lm)
