shape = guide_legend(override.aes = list(size = 4))) +ggtitle("Nitrogen Use Composition")
eco.dist <- vegdist(c, method = "bray")
eco.dist <- vegdist(c, method = "euclidean")
# Principal Coordinates Analysis
dataREL.dist <- eco.dist
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #39.2
explainvar2b #16.1
#Want to calculate the shannon diversity index @ T04 for a sample
#And then combine all samples for a treatment
#Subset master biolog file to include only nitro plates
eco <- biolog_master[(biolog_master$plate_type %in% "ECO"),]
#subset to include only T04
eco_T <- eco %>%
filter(timepoint=="T04") %>%
filter(sample != "201-M-EC-2")
#Subset design file
biolog_design <- biolog_design %>%
filter(sample != "201-M-EC-2")
#for each plate in eco_T, calculate adjusted abs for each substance in each rep, 3 reps per plate
#plate_num, sample, substance, rep 1 is well == 1:4, rep 2 is well == 5:8, rep 3 is well == 9:12
#Each rep has its own negative control (water)
eco_rep1 <- eco_T %>%
filter(Substance != "water") %>%
filter(Well %in% c(1,2,3,4))
eco_rep2 <- eco_T %>%
filter(Substance != "water") %>%
filter(Well %in% c(5,6,7,8))
eco_rep3 <- eco_T %>%
filter(Substance != "water") %>%
filter(Well %in% c(9,10,11,12))
#get water value to substract from all other substances
eco_rep1_water <- eco_T %>%
filter(Substance == "water",Well==c(1,2,3,4)) %>%
group_by(sample, plate_num, Substance)
eco_rep2_water <- eco_T %>%
filter(Substance == "water",Well==c(5,6,7,8)) %>%
group_by(sample, plate_num, Substance)
eco_rep3_water <- eco_T %>%
filter(Substance == "water",Well==c(9,10,11,12)) %>%
group_by(sample, plate_num, Substance)
#Timepoint T04, All substances except water in rep1 (ie wells 1-4 and rows a-h) joined with water value
eco_rep1_join <- eco_rep1 %>% left_join(eco_rep1_water, by=c("sample"))
eco_rep2_join <- eco_rep2 %>% left_join(eco_rep2_water, by=c("sample"))
eco_rep3_join <- eco_rep3 %>% left_join(eco_rep3_water, by=c("sample"))
#Coalesce and then add adjusted abs column  - adj. abs
eco_joined <- bind_rows(eco_rep1_join, eco_rep2_join, eco_rep3_join)
eco_joined_adj <- eco_joined %>%
mutate(adj_abs = abs.x-abs.y)
#Need to add a design file...
eco_joined_adj <- eco_joined_adj %>% left_join(biolog_design, by=c("sample"))
eco_subs <- ggplot(eco_joined_adj, aes(treatment, Substance.x)) +
geom_tile(aes(fill = scale(adj_abs)), colour = "white") +
scale_fill_gradient(low = "white", high = "purple") +
facet_grid(~ source)
eco_subs
#Transform so that substances are columns and sample is row?
#First select just the columns needed... then turn negatve values into 0
eco_joined_adj_sub <- eco_joined_adj %>%
select(Substance.x, sample,  adj_abs ) %>%
mutate(adj_abs = ifelse(adj_abs < 0, 0, adj_abs)) #%>%
#I want Substance.x to be columns and sample to be rows and vales to be adj_abs
m <- melt(eco_joined_adj_sub)
c<-cast(data=m, formula = sample ~ Substance.x,fun.aggregate = sum)
otu.2.201 <- otu.2[-c(17),]
eco.dist <- vegdist(c, method = "euclidean")
# Principal Coordinates Analysis
dataREL.dist <- eco.dist
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #39.2
explainvar2b #16.1
# Principal Coordinates Analysis - bulk and teas
new.data <-cbind(biolog_design,c)
pcoa.groups <- paste(new.data$treatment, new.data$source, new.data$ditch, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
trt.c <- c("M","M","M","MF","MF","MF")
source.c <- c("bulk soil","forb","grass","bulk soil","forb","grass")
pcoa.cent.dataframe.trts <- as.data.frame(pcoa.cent.dataframe)
pcoa.cent.dataframe.trts$trt <- as.factor(trt.c)
pcoa.cent.dataframe.trts$source <- as.factor(source.c)
#Plot
df1a <- as.data.frame(pcoa.cent.dataframe.trts)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=trt, shape = source,
group = interaction(trt, source))) + theme_bw()
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") + geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") + geom_point(aes(colour=trt.c), size=5, stroke = 1.25, show.legend = TRUE) +
scale_colour_manual(labels = c("mowed","mowed/fertilized"),
values = c("darkgray", "darkgreen")) +
scale_shape_manual(labels = c("bulk soil",
"forb",
"grass"),
values = c(16,22,15)) +
theme(axis.title = element_text(size=14), axis.text = element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size = 1.25)) +
theme(axis.ticks.length = unit(0.3, "cm")) +
xlab("PCoA 1 (39.2%)") + ylab("PCoA 2 (16.1%)") +
labs(colour = "treatment", shape = "source") +
guides(colour = guide_legend(override.aes = list(pch=16, size = 4)),
shape = guide_legend(override.aes = list(size = 4)))+ggtitle("Carbon Use Composition")
ggsave("../figures/WRC18_Rhizo/Ordination_ecoplate.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=5, height=3, dpi=300, limitsize=TRUE)
nitro <- biolog_master[(biolog_master$plate_type %in% "PM3B"),]
#subset to include only T04
nitro_T <- nitro %>%
filter(timepoint=="T04") %>%
filter(sample != "201-M-EC-2")
#Subset design file
biolog_design <- biolog_design %>%
filter(sample != "201-M-EC-2")
#2 reps (A&B) per sample. Each plate is a rep.
#for each plate in nitro_T, calculate adjusted abs for each substance
#Each plate/rep has its own negative control (water)
#then combine reps
nitro_rep1 <- nitro_T %>%
filter(Substance != "negative control")
#get water value to substract from all other substances
nitro_rep1_water <- nitro_T %>%
filter(Substance == "negative control") %>%
group_by(sample, plate_num, Substance, rep)
#Timepoint T04, All substances except water in rep1 (ie wells 1-4 and rows a-h) joined with water value
nitro_rep1_join <- nitro_rep1 %>% left_join(nitro_rep1_water, by=c("sample", "rep"))
#Coalesce and then add adjusted abs column  - adj. abs
nitro_joined_adj <- nitro_rep1_join %>%
mutate(adj_abs = abs.x-abs.y)
#Combine reps#####
#Need to add a design file...
nitro_joined_adj <- nitro_joined_adj %>% left_join(biolog_design, by=c("sample"))
#Transform so that substances are columns and sample is row?
#First select just the columns needed... then turn negatve values into 0
nitro_joined_adj_sub <- nitro_joined_adj %>%
select(Substance.x, sample,  adj_abs ) %>%
mutate(adj_abs = ifelse(adj_abs < 0, 0, adj_abs)) #%>%
#I want Substance.x to be columns and sample to be rows and vales to be adj_abs
m <- melt(nitro_joined_adj_sub)
c<-cast(data=m, formula = sample ~ Substance.x,fun.aggregate = sum)
nitro.dist <- vegdist(c, method = "euclidean")
# Principal Coordinates Analysis
dataREL.dist <- nitro.dist
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #39.2
explainvar2b #16.1
# Principal Coordinates Analysis - bulk and teas
new.data <-cbind(biolog_design,c)
pcoa.groups <- paste(new.data$treatment, new.data$source, new.data$ditch, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
trt.c <- c("M","M","M","MF","MF","MF")
source.c <- c("bulk soil","forb","grass","bulk soil","forb","grass")
pcoa.cent.dataframe.trts <- as.data.frame(pcoa.cent.dataframe)
pcoa.cent.dataframe.trts$trt <- as.factor(trt.c)
pcoa.cent.dataframe.trts$source <- as.factor(source.c)
#Plot
df1a <- as.data.frame(pcoa.cent.dataframe.trts)
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=trt, shape = source,
group = interaction(trt, source))) + theme_bw()
#Plot
df2a <- as.data.frame(pcoa.cent.dataframe.trts)
plot2a <- ggplot(df2a, aes(x=V1, y=V2, colour=trt, shape = source,
group = interaction(trt, source))) + theme_bw()
plot2a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") + geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") + geom_point(aes(colour=trt.c), size=5, stroke = 1.25, show.legend = TRUE) +
scale_colour_manual(labels = c("mowed","mowed/fertilized"),
values = c("darkgray", "darkgreen")) +
scale_shape_manual(labels = c("bulk soil",
"forb",
"grass"),
values = c(16,22,15)) +
theme(axis.title = element_text(size=14), axis.text = element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size = 1.25)) +
theme(axis.ticks.length = unit(0.3, "cm")) +
xlab("PCoA 1 (50.3%)") + ylab("PCoA 2 (7.5%)") +
labs(colour = "treatment", shape = "source") +
guides(colour = guide_legend(override.aes = list(pch=16, size = 4)),
shape = guide_legend(override.aes = list(size = 4)))+ggtitle("Nitrogen Use Composition")
ggsave("../figures/WRC18_Rhizo/Ordination_nitroplate.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=5, height=3, dpi=300, limitsize=TRUE)
o4 <- biolog_master[(biolog_master$plate_type %in% "PM4A"),]
#subset to include only T04
po4_T <- po4 %>%
filter(timepoint=="T04") %>%
filter(sample != "201-M-EC-2")
#For each treatment*source get count of group (group is the category of substrate)
#Presence absence; set a threshold positive value
#Left join substrate group to biolog results to add group to each substrate?
biolog_sub_groups <- read.csv("../data/WRC18_Rhizo/biolog_substrate_groups.csv")
biolog_sub_groups <- biolog_sub_groups %>%
filter(plate_type=="PM4A")
po4_joined_adj_sub <- po4_joined_adj_sub %>%
#rename(Substance = Substance.x) %>%
left_join(biolog_sub_groups, by="Substance") %>%
mutate(PA = ifelse(adj_abs < 0.5, 0, 1) )
#Transform so that substances are columns and sample is row?
#First select just the columns needed... then turn negatve values into 0
po4_joined_adj_sub <- po4_joined_adj %>%
select(Substance.x, sample,  adj_abs ) %>%
mutate(adj_abs = ifelse(adj_abs < 0, 0, adj_abs)) #%>%
#Subset master biolog file to include only nitro plates
po4 <- biolog_master[(biolog_master$plate_type %in% "PM4A"),]
#subset to include only T04
po4_T <- po4 %>%
filter(timepoint=="T04") %>%
filter(sample != "201-M-EC-2")
#Subset design file
biolog_design <- biolog_design %>%
filter(sample != "201-M-EC-2")
#po4 A1-E12
po4_rep1 <- po4_T %>%
filter(Substance != "negative control") %>%
filter(Well %in% c(1:12) & Row %in% c("A","B","C","D","E"))
#sulfur F1-H12
sulfur_rep1 <- po4_T %>%
filter(Substance != "negative control") %>%
filter(Well %in% c(1:12),Row %in% c("F","G","H"))
#get water value to substract from all other substances
po4_rep1_water <- po4_T %>%
filter(Substance == "negative control",Row ==c("A")) %>%
group_by(sample, plate_num, Substance, rep )
sulfur_rep1_water <- po4_T %>%
filter(Substance == "negative control",Row ==c("F")) %>%
group_by(sample, plate_num, Substance, rep)
#Timepoint T04, All substances except water in rep1 (ie wells 1-4 and rows a-h) joined with water value
po4_joined <- po4_rep1 %>% left_join(po4_rep1_water, by=c("sample"))
sulfur_joined <- sulfur_rep1 %>% left_join(sulfur_rep1_water, by=c("sample"))
#add adjusted abs column  - adj. abs
po4_joined_adj <- po4_joined %>%
mutate(adj_abs = abs.x-abs.y)
sulfur_joined_adj <- sulfur_joined %>%
mutate(adj_abs = abs.x-abs.y)
#Need to add a design file...
po4_joined_adj <- po4_joined_adj %>% left_join(biolog_design, by=c("sample"))
sulfur_joined_adj <- sulfur_joined_adj %>% left_join(biolog_design, by=c("sample"))
po4_subs <- ggplot(po4_joined_adj, aes(treatment, Substance.x)) +
geom_tile(aes(fill = scale(adj_abs)), colour = "white") +
scale_fill_gradient(low = "white", high = "purple") +
facet_grid(~ source)
po4_subs
sulfur_subs <- ggplot(sulfur_joined_adj, aes(treatment, Substance.x)) +
geom_tile(aes(fill = scale(adj_abs)), colour = "white") +
scale_fill_gradient(low = "white", high = "purple") +
facet_grid(~ source)
sulfur_subs
#Transform so that substances are columns and sample is row?
#First select just the columns needed... then turn negatve values into 0
po4_joined_adj_sub <- po4_joined_adj %>%
select(Substance.x, sample,  adj_abs ) %>%
mutate(adj_abs = ifelse(adj_abs < 0, 0, adj_abs)) #%>%
#I want Substance.x to be columns and sample to be rows and vales to be adj_abs
m <- melt(po4_joined_adj_sub)
c<-cast(data=m, formula = sample ~ Substance.x,fun.aggregate = sum)
#biolog_design is design file
#make sure to run PM3 ecodist before proceeding
phos.dist <- vegdist(c, method = "euclidean")
# Principal Coordinates Analysis
dataREL.dist <- phos.dist
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #50.3
explainvar2b #7.5
# Principal Coordinates Analysis - bulk and teas
new.data <-cbind(biolog_design,c)
pcoa.groups <- paste(new.data$treatment, new.data$source, new.data$ditch, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
trt.c <- c("M","M","M","MF","MF","MF")
source.c <- c("bulk soil","forb","grass","bulk soil","forb","grass")
pcoa.cent.dataframe.trts <- as.data.frame(pcoa.cent.dataframe)
pcoa.cent.dataframe.trts$trt <- as.factor(trt.c)
pcoa.cent.dataframe.trts$source <- as.factor(source.c)
#Plot
df3a <- as.data.frame(pcoa.cent.dataframe.trts)
plot3a <- ggplot(df3a, aes(x=V1, y=V2, colour=trt, shape = source,
group = interaction(trt, source))) + theme_bw()
plot3a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") + geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") + geom_point(aes(colour=trt.c), size=5, stroke = 1.25, show.legend = TRUE) +
scale_colour_manual(labels = c("mowed","mowed/fertilized"),
values = c("darkgray", "darkgreen")) +
scale_shape_manual(labels = c("bulk soil",
"forb",
"grass"),
values = c(16,22,15)) +
theme(axis.title = element_text(size=14), axis.text = element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size = 1.25)) +
theme(axis.ticks.length = unit(0.3, "cm")) +
xlab("PCoA 1 (51.3%)") + ylab("PCoA 2 (10.4%)") +
labs(colour = "treatment", shape = "source") +
guides(colour = guide_legend(override.aes = list(pch=16, size = 4)),
shape = guide_legend(override.aes = list(size = 4)))+ggtitle("Phosphorus Use Composition")
ggsave("../figures/WRC18_Rhizo/Ordination_PM3plate.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=5, height=3, dpi=300, limitsize=TRUE)
#SULFUR
#Transform so that substances are columns and sample is row?
#First select just the columns needed... then turn negatve values into 0
sulfur_joined_adj_sub <- sulfur_joined_adj %>%
select(Substance.x, sample,  adj_abs ) %>%
mutate(adj_abs = ifelse(adj_abs < 0, 0, adj_abs)) #%>%
#I want Substance.x to be columns and sample to be rows and vales to be adj_abs
m <- melt(sulfur_joined_adj_sub)
c<-cast(data=m, formula = sample ~ Substance.x,fun.aggregate = sum)
#biolog_design is design file
#make sure to run PM3 ecodist before proceeding
sulfur.dist <- vegdist(c, method = "euclidean")
# Principal Coordinates Analysis
dataREL.dist <- sulfur.dist
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #51.3
explainvar1b #46.7
explainvar2b #10.4
# Principal Coordinates Analysis - bulk and teas
new.data <-cbind(biolog_design,c)
pcoa.groups <- paste(new.data$treatment, new.data$source, new.data$ditch, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
trt.c <- c("M","M","M","MF","MF","MF")
source.c <- c("bulk soil","forb","grass","bulk soil","forb","grass")
pcoa.cent.dataframe.trts <- as.data.frame(pcoa.cent.dataframe)
pcoa.cent.dataframe.trts$trt <- as.factor(trt.c)
pcoa.cent.dataframe.trts$source <- as.factor(source.c)
#Plot
df4a <- as.data.frame(pcoa.cent.dataframe.trts)
plot4a <- ggplot(df4a, aes(x=V1, y=V2, colour=trt, shape = source,
group = interaction(trt, source))) + theme_bw()
plot4a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") + geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") + geom_point(aes(colour=trt.c), size=5, stroke = 1.25, show.legend = TRUE) +
scale_colour_manual(labels = c("mowed","mowed/fertilized"),
values = c("darkgray", "darkgreen")) +
scale_shape_manual(labels = c("bulk soil",
"forb",
"grass"),
values = c(16,22,15)) +
theme(axis.title = element_text(size=14), axis.text = element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size = 1.25)) +
theme(axis.ticks.length = unit(0.3, "cm")) +
xlab("PCoA 1 (46.7%)") + ylab("PCoA 2 (10.6%)") +
labs(colour = "treatment", shape = "source") +
guides(colour = guide_legend(override.aes = list(pch=16, size = 4)),
shape = guide_legend(override.aes = list(size = 4)))+ggtitle("Sulfur Use Composition")
ggsave("../figures/WRC18_Rhizo/Ordination_sulfurplate.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=5, height=3, dpi=300, limitsize=TRUE)
rm(list=ls())
setwd("~/GitHub/WRC_FertMowing/analyses")
opar <- par(no.readonly = TRUE)  # Saves plot defaults
# Add Summary Functions
se <- function(x, ...){sd(x, na.rm = TRUE)/sqrt(length(na.omit(x)))}
ci <- function(x, ...){1.96 * sd(x,na.rm = TRUE)}
# Code Dependencies
library(MASS)
library(nlme)
library(reshape2)
library(vegan)
library(reshape)
library(lme4)
library(ggplot2)
require("png")
require("grid")
PCC <- read.csv("../data/WRC_Importance.csv", header=TRUE)
labels(PCC)
treatments <- PCC$treatment
levels(treatments) <- c("UM/UF", "UM/F", "M/UF", "M/F")
PCC.trts <- cbind(treatments,PCC)
PCC$Fertilizer <- factor(PCC$Fertilizer)
PCC$Mowing <- factor(PCC$Mowing)
PCC$Ditch <- factor (PCC$Ditch)
str(PCC)
#incorporated strata to restrict permutation within similar treatment
PCC.dist <- vegdist(PCC[,-c(1:9)], method="bray")
adonis1 = adonis(PCC[,-c(1:9)] ~ Fertilizer*Mowing*Year*Ditch+(1|Ditch/BLOCK/QUADRAT..), method = "bray", data = PCC, perm=1000)
adonis2 = adonis(PCC[,-c(1:9)] ~ Fertilizer*Mowing*Year+Ditch+(1|Ditch/BLOCK/QUADRAT..), method = "bray", data = PCC, perm=1000)
adonis2
adonis3 = adonis(PCC[,-c(1:9)] ~ Fertilizer*Mowing*Year*BLOCK+Ditch+(1|QUADRAT..), strata=method = "bray", data = PCC, perm=1000)
adonis3 = adonis(PCC[,-c(1:9)] ~ Fertilizer*Mowing*Year*BLOCK+Ditch+(1|QUADRAT..), method = "bray", data = PCC, perm=1000)
adonis3
adonis3 = adonis(PCC[,-c(1:9)] ~ Fertilizer*Mowing*Year*BLOCK+Ditch+(1|BLOCK/QUADRAT..), method = "bray", data = PCC, perm=1000)
adonis3
adonis3 = adonis(PCC[,-c(1:9)] ~ Fertilizer*Mowing*Year*+Ditch+(1|Ditc/BLOCK/QUADRAT..), method = "bray", data = PCC, perm=1000)
adonis3 = adonis(PCC[,-c(1:9)] ~ Fertilizer*Mowing*Year*+Ditch+(1|Ditch/BLOCK/QUADRAT..), method = "bray", data = PCC, perm=1000)
adonis3 = adonis(PCC[,-c(1:9)] ~ Fertilizer*Mowing*Year*+Ditch+(1|BLOCK/QUADRAT..), method = "bray", data = PCC, perm=1000)
adonis3
adonis3 = adonis(PCC[,-c(1:9)] ~ Fertilizer*Mowing*Year*+Ditch+(1|BLOCK/QUADRAT..), strata=Year, method = "bray", data = PCC, perm=1000)
adonis2 = adonis(PCC[,-c(1:9)] ~ Fertilizer*Mowing*Year+Ditch+(1|Ditch/BLOCK/QUADRAT..), method = "bray", data = PCC, perm=1000)
rm(list=ls())
setwd("~/GitHub/WRC_FertMowing/analyses")
# Code Dependencies
library(ggplot2)
library(glmmTMB)
library(bbmle)
library(broom.mixed)
library(car)
library(effects)
library(aods3)
library(gridExtra)
WRC_dat.2 <- read.csv("../data/WRC_Plant_Diversity.csv")
head(WRC_dat.2)
WRC_dat.2$Ditch=as.factor(WRC_dat.2$Ditch)
WRC_dat.2$Fertilizer=as.factor(WRC_dat.2$Fertilizer)
WRC_dat.2$Mowing=as.factor(WRC_dat.2$Mowing)
ggplot(WRC_dat.2,aes(x=Year,y=alpha,group=Ditch,colour=factor(Ditch)))+
stat_summary(fun.data=mean_cl_boot,size=1)+facet_wrap(~Fertilizer*Mowing,labeller = label_both)
m1=glmmTMB(alpha~(scale(Year)*Fertilizer*Mowing)+Ditch+
Anova(m1,type="II")
alphae <- allEffects(m1)
alphae
alphae <- allEffects(m1)
m1=glmmTMB(alpha~(scale(Year)*Fertilizer*Mowing)+Ditch+
m1=glmmTMB(alpha~(scale(Year)*Fertilizer*Mowing)+Ditch+
m1=glmmTMB(alpha~(scale(Year)*Fertilizer*Mowing)+Ditch+
(1|BLOCK/QUADRAT..), data=WRC_dat.2, family=gaussian(log))
alphae <- allEffects(m1)
alphae
plot(alphae)
summary(m1)
Anova(m1,type="II")
m1=glmmTMB(alpha~(scale(Year)*Fertilizer*Mowing)+Ditch+
(1|BLOCK/QUADRAT..), data=WRC_dat.2, family=gaussian(log))
Anova(m1,type="II")
Ditch/
m1=glmmTMB(alpha~(scale(Year)*Fertilizer*Mowing)+Ditch+
(1|Ditch/BLOCK/QUADRAT..), data=WRC_dat.2, family=gaussian(log))
m1=glmmTMB(alpha~(scale(Year)*Fertilizer*Mowing)+Ditch+
(1|Ditch/BLOCK/QUADRAT..), data=WRC_dat.2, family=gaussian(log))
Anova(m1,type="II")
summary(m1)
m1=glmmTMB(alpha~(scale(Year)*Fertilizer*Mowing)+Ditch+
(1|Ditch:(BLOCK:QUADRAT..)), data=WRC_dat.2, family=gaussian(log))
m1
Anova(m1,type="II")
summary(m1)
m1=glmmTMB(alpha~(scale(Year)*Fertilizer*Mowing)+Ditch+
(1|Ditch/BLOCK/QUADRAT..), data=WRC_dat.2, family=gaussian(log))
summary(m1)
m1=glmmTMB(alpha~(scale(Year)*Fertilizer*Mowing*Ditch)+
(1|Ditch/BLOCK/QUADRAT..), data=WRC_dat.2, family=gaussian(log))
Anova(m1,type="II")
alphae <- allEffects(m1)
alphae
plot(alphae)
pdf("../figures/All_Plant_Diversity_separate.pdf")
plot(alphae)
dev.off()
pdf("../figures/All_Plant_Diversity_separate.pdf")
plot(alphae)
dev.off()
pdf("../figures/All_Plant_Diversity_separate.pdf")
plot(alphae)
dev.off()
dev.new()
pdf("../figures/All_Plant_Diversity_separate.pdf")
plot(alphae)
graphics.off()
dev.new()
pdf("../figures/All_Plant_Diversity_separate.pdf")
plot(alphae)
graphics.off()
plot(alphae)
